stages:
  - test
  - deploy

default:
  image: gradle:jdk17-corretto
  before_script:
    - export GRADLE_USER_HOME=`pwd`/.gradle_home
    - echo bhmNexusUsername=$NEXUS_SERVICE_USERNAME >> $GRADLE_USER_HOME/gradle.properties
    - echo bhmNexusPassword=$NEXUS_SERVICE_PASSWORD >> $GRADLE_USER_HOME/gradle.properties
  cache:
    - key:
        files:
          - build.gradle.kts
          - settings.gradle.kts
          - spring/build.gradle.kts
          - backend/build.gradle.kts
      paths:
        - .gradle_home

test:
  stage: test
  script:
    - ./gradlew clean test --build-cache

deploy:
  stage: deploy
  script:
    - ./gradlew publish